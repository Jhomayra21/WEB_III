@page
@model Practica1.Pages.IndexModel
@{
    ViewData["Title"] = "Tareas Asignadas";
}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />

<div class="fila-entre" style="margin-top:20px;">
    <form method="get" style="margin-bottom:15px;">
        <label>
            Mostrar:
            <select name="tamanio" onchange="this.form.submit()" style="margin:0 5px; padding:5px; border-radius:4px; border:1px solid #ccc;">
                @if (Model.TamanoPagina == 5)
                {
                    <option value="5" selected="selected">5</option>
                }
                else
                {
                    <option value="5">5</option>
                }

                @if (Model.TamanoPagina == 10)
                {
                    <option value="10" selected="selected">10</option>
                }
                else
                {
                    <option value="10">10</option>
                }

                @if (Model.TamanoPagina == 15)
                {
                    <option value="15" selected="selected">15</option>
                }
                else
                {
                    <option value="15">15</option>
                }

                @if (Model.TamanoPagina == 25)
                {
                    <option value="25" selected="selected">25</option>
                }
                else
                {
                    <option value="25">25</option>
                }

                @if (Model.TamanoPagina == 50)
                {
                    <option value="50" selected="selected">50</option>
                }
                else
                {
                    <option value="50">50</option>
                }
            </select>
            tareas por página
        </label>
    </form>
</div>

<div style="color:#444; margin-bottom:15px;">
    Mostrando @(Model.TotalTareas == 0 ? 0 : ((Model.PaginaActual-1)*Model.TamanoPagina)+1) 
    - 
    @(Math.Min(Model.PaginaActual*Model.TamanoPagina, Model.TotalTareas)) 
    de @Model.TotalTareas tareas
</div>

<div class="tabla-responsive">
    <table class="tabla-tareas">
        <thead>
            <tr>
                <th>Nombre Tarea</th>
                <th>Fecha Vencimiento</th>
                <th>Estado Tarea</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            @if (Model.Tareas.Count == 0)
            {
                <tr>
                    <td colspan="4">No hay tareas para mostrar</td>
                </tr>
            }
            else
            {
                @foreach (var tarea in Model.Tareas)
                {
                    <tr>
                        <td>@tarea.nombreTarea</td>
                        <td>@tarea.fechaVencimiento</td>
                        <td>
                            @if (tarea.estado == "Pendiente")
                            {
                                <span class="estado-pendiente">@tarea.estado</span>
                            }
                            else if (tarea.estado == "En curso")
                            {
                                <span class="estado-encurso">@tarea.estado</span>
                            }
                            else if (tarea.estado == "Finalizado")
                            {
                                <span class="estado-finalizado">@tarea.estado</span>
                            }
                            else
                            {
                                <span class="estado-cancelado">@tarea.estado</span>
                            }
                        </td>
                        <td>
                            <a href="#" class="btn-editar" title="Editar">
                                <i class="fa-solid fa-pen-to-square"></i>
                            </a>
                            <a href="#" class="btn-eliminar" title="Eliminar">
                                <i class="fa-solid fa-trash"></i>
                            </a>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>

<div style="text-align: center; margin-top: 20px;">
    <ul style="display: flex; list-style-type: none; padding: 0; justify-content: center;">
        @for (int i = 1; i <= Model.TotalPaginas; i++)
        {
            <li style="margin: 0 5px;">
                <a href="?pagina=@i&tamanio=@Model.TamanoPagina" 
                   style="padding: 8px 12px; text-decoration: none; border-radius: 4px; 
                         @(i == Model.PaginaActual ? 
                            "background-color: #3163c9; color: white;" : 
                            "background-color: #eaf1fb; color: #333;")">
                    @i
                </a>
            </li>
        }
    </ul>
</div>

<div style="margin-bottom: 20px;">
    <button type="button" class="btn-agregar-tarea" onclick="mostrarFormularioTarea()">
        <i class="fa-solid fa-plus"></i> Nueva Tarea
    </button>
</div>

<div id="formularioTarea" class="modal-tarea" style="display:none;">
    <div class="modal-tarea-contenido">
        <span class="cerrar-modal" onclick="ocultarFormularioTarea()">&times;</span>
        <h2>Nueva Tarea</h2>
        <form method="post">
            <div>
                <label>Nombre de la tarea:</label>
                <input type="text" asp-for="NuevaTarea.nombreTarea" required class="form-control" />
            </div>
            <div>
                <label>Fecha de vencimiento:</label>
                <input type="date" asp-for="NuevaTarea.fechaVencimiento" required class="form-control" />
            </div>
            <div>
                <label>Estado:</label>
                <select asp-for="NuevaTarea.estado" class="form-control" required>
                    <option value="Pendiente">Pendiente</option>
                    <option value="En curso">En curso</option>
                    <option value="Finalizado">Finalizado</option>
                    <option value="Cancelado">Cancelado</option>
                </select>
            </div>
            <div style="margin-top: 15px;">
                <button type="submit" class="btn-agregar-tarea">Guardar</button>
                <button type="button" class="btn-eliminar" onclick="ocultarFormularioTarea()">Cancelar</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        function mostrarFormularioTarea() {
            document.getElementById('formularioTarea').style.display = 'block';
        }
        function ocultarFormularioTarea() {
            document.getElementById('formularioTarea').style.display = 'none';
        }
    </script>
}